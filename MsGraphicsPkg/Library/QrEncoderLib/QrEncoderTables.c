/**@file
QrEncoderTables.c

Tables used in the construction of QrCodes

Copyright (C) Microsoft Corporation. All rights reserved.
SPDX-License-Identifier: BSD-2-Clause-Patent

**/

#include <Uefi.h>

#include <Library/DebugLib.h>
#include <Library/MemoryAllocationLib.h>            // AllocatePool
#include <Library/QrEncoderLib.h>
#include <Library/UefiBootServicesTableLib.h>       // gBS

#include "QrEncoderTables.h"

CONST  QrTableEntry gQrTable[QR_TABLE_ENTRIES] = { // Combination of data from Table 7 and Table 9 in ISO 18004
        //                          Code    EC      G1       G1    G2       G2     Extra  Max      Max      Max    Max
        //                          Words   Words   Blocks   Size  Blocks   Size   Bits   Numeric  Alpha    Byte   Kanji
        //                                  per Block
        {  /*    1-L  * */            19,      7,      1,     19,      0,      0,      0,     41,     25,     17,     10   },
        {  /*    1-M  * */            16,     10,      1,     16,      0,      0,      0,     34,     20,     14,      8   },
        {  /*    1-Q  * */            13,     13,      1,     13,      0,      0,      0,     27,     16,     11,      7   },
        {  /*    1-H  * */             9,     17,      1,      9,      0,      0,      0,     17,     10,      7,      4   },
        {  /*    2-L    */            34,     10,      1,     34,      0,      0,      7,     77,     47,     32,     20   },
        {  /*    2-M  * */            28,     16,      1,     28,      0,      0,      7,     63,     38,     26,     16   },
        {  /*    2-Q  * */            22,     22,      1,     22,      0,      0,      7,     48,     29,     20,     12   },
        {  /*    2-H  * */            16,     28,      1,     16,      0,      0,      7,     34,     20,     14,      8   },
        {  /*    3-L  * */            55,     15,      1,     55,      0,      0,      7,    127,     77,     53,     32   },
        {  /*    3-M  * */            44,     26,      1,     44,      0,      0,      7,    101,     61,     42,     26   },
        {  /*    3-Q  * */            34,     18,      2,     17,      0,      0,      7,     77,     47,     32,     20   },
        {  /*    3-H  * */            26,     22,      2,     13,      0,      0,      7,     58,     35,     24,     15   },
        {  /*    4-L  * */            80,     20,      1,     80,      0,      0,      7,    187,    114,     78,     48   },
        {  /*    4-M    */            64,     18,      2,     32,      0,      0,      7,    149,     90,     62,     38   },
        {  /*    4-Q    */            48,     26,      2,     24,      0,      0,      7,    111,     67,     46,     28   },
        {  /*    4-H    */            36,     16,      4,      9,      0,      0,      7,     82,     50,     34,     21   },
        {  /*    5-L    */           108,     26,      1,    108,      0,      0,      7,    255,    154,    106,     65   },
        {  /*    5-M  * */            86,     24,      2,     43,      0,      0,      7,    202,    122,     84,     52   },
        {  /*    5-Q    */            62,     18,      2,     15,      2,     16,      7,    144,     87,     60,     37   },
        {  /*    5-H    */            46,     22,      2,     11,      2,     12,      7,    106,     64,     44,     27   },
        {  /*    6-L    */           136,     18,      2,     68,      0,      0,      7,    322,    195,    134,     82   },
        {  /*    6-M    */           108,     16,      4,     27,      0,      0,      7,    255,    154,    106,     65   },
        {  /*    6-Q    */            76,     24,      4,     19,      0,      0,      7,    178,    108,     74,     45   },
        {  /*    6-H    */            60,     28,      4,     15,      0,      0,      7,    139,     84,     58,     36   },
        {  /*    7-L    */           156,     20,      2,     78,      0,      0,      0,    370,    224,    154,     95   },
        {  /*    7-M    */           124,     18,      4,     31,      0,      0,      0,    293,    178,    122,     75   },
        {  /*    7-Q    */            88,     18,      2,     14,      4,     15,      0,    207,    125,     86,     53   },
        {  /*    7-H    */            66,     26,      4,     13,      1,     14,      0,    154,     93,     64,     39   },
        {  /*    8-L    */           194,     24,      2,     97,      0,      0,      0,    461,    279,    192,    118   },
        {  /*    8-M    */           154,     22,      2,     38,      2,     39,      0,    365,    221,    152,     93   },
        {  /*    8-Q    */           110,     22,      4,     18,      2,     19,      0,    259,    157,    108,     66   },
        {  /*    8-H    */            86,     26,      4,     14,      2,     15,      0,    202,    122,     84,     52   },
        {  /*    9-L  * */           232,     30,      2,    116,      0,      0,      0,    552,    335,    230,    141   },
        {  /*    9-M    */           182,     22,      3,     36,      2,     37,      0,    432,    262,    180,    111   },
        {  /*    9-Q    */           132,     20,      4,     16,      4,     17,      0,    312,    189,    130,     80   },
        {  /*    9-H    */           100,     24,      4,     12,      4,     13,      0,    235,    143,     98,     60   },
        {  /*    10-L   */           274,     18,      2,     68,      2,     69,      0,    652,    395,    271,    167   },
        {  /*    10-M   */           216,     26,      4,     43,      1,     44,      0,    513,    311,    213,    131   },
        {  /*    10-Q   */           154,     24,      6,     19,      2,     20,      0,    364,    221,    151,     93   },
        {  /*    10-H   */           122,     28,      6,     15,      2,     16,      0,    288,    174,    119,     74   },
        {  /*    11-L   */           324,     20,      4,     81,      0,      0,      0,    772,    468,    321,    198   },
        {  /*    11-M   */           254,     30,      1,     50,      4,     51,      0,    604,    366,    251,    155   },
        {  /*    11-Q   */           180,     28,      4,     22,      4,     23,      0,    427,    259,    177,    109   },
        {  /*    11-H   */           140,     24,      3,     12,      8,     13,      0,    331,    200,    137,     85   },
        {  /*    12-L   */           370,     24,      2,     92,      2,     93,      0,    883,    535,    367,    226   },
        {  /*    12-M   */           290,     22,      6,     36,      2,     37,      0,    691,    419,    287,    177   },
        {  /*    12-Q   */           206,     26,      4,     20,      6,     21,      0,    489,    296,    203,    125   },
        {  /*    12-H   */           158,     28,      7,     14,      4,     15,      0,    374,    227,    155,     96   },
        {  /*    13-L   */           428,     26,      4,    107,      0,      0,      0,   1022,    619,    425,    262   },
        {  /*    13-M   */           334,     22,      8,     37,      1,     38,      0,    796,    483,    331,    204   },
        {  /*    13-Q   */           244,     24,      8,     20,      4,     21,      0,    580,    352,    241,    149   },
        {  /*    13-H   */           180,     22,     12,     11,      4,     12,      0,    427,    259,    177,    109   },
        {  /*    14-L   */           461,     30,      3,    115,      1,    116,      3,   1101,    667,    458,    282   },
        {  /*    14-M   */           365,     24,      4,     40,      5,     41,      3,    871,    528,    362,    223   },
        {  /*    14-Q   */           261,     20,     11,     16,      5,     17,      3,    621,    376,    258,    159   },
        {  /*    14-H   */           197,     24,     11,     12,      5,     13,      3,    468,    283,    194,    120   },
        {  /*    15-L   */           523,     22,      5,     87,      1,     88,      3,   1250,    758,    520,    320   },
        {  /*    15-M   */           415,     24,      5,     41,      5,     42,      3,    991,    600,    412,    254   },
        {  /*    15-Q   */           295,     30,      5,     24,      7,     25,      3,    703,    426,    292,    180   },
        {  /*    15-H   */           223,     24,     11,     12,      7,     13,      3,    530,    321,    220,    136   },
        {  /*    16-L   */           589,     24,      5,     98,      1,     99,      3,   1408,    854,    586,    361   },
        {  /*    16-M   */           453,     28,      7,     45,      3,     46,      3,   1082,    656,    450,    277   },
        {  /*    16-Q   */           325,     24,     15,     19,      2,     20,      3,    775,    470,    322,    198   },
        {  /*    16-H   */           253,     30,      3,     15,     13,     16,      3,    602,    365,    250,    154   },
        {  /*    17-L   */           647,     28,      1,    107,      5,    108,      3,   1548,    938,    644,    397   },
        {  /*    17-M   */           507,     28,     10,     46,      1,     47,      3,   1212,    734,    504,    310   },
        {  /*    17-Q   */           367,     28,      1,     22,     15,     23,      3,    876,    531,    364,    224   },
        {  /*    17-H   */           283,     28,      2,     14,     17,     15,      3,    674,    408,    280,    173   },
        {  /*    18-L   */           721,     30,      5,    120,      1,    121,      3,   1725,   1046,    718,    442   },
        {  /*    18-M   */           563,     26,      9,     43,      4,     44,      3,   1346,    816,    560,    345   },
        {  /*    18-Q   */           397,     28,     17,     22,      1,     23,      3,    948,    574,    394,    243   },
        {  /*    18-H   */           313,     28,      2,     14,     19,     15,      3,    746,    452,    310,    191   },
        {  /*    19-L   */           795,     28,      3,    113,      4,    114,      3,   1903,   1153,    792,    488   },
        {  /*    19-M   */           627,     26,      3,     44,     11,     45,      3,   1500,    909,    624,    384   },
        {  /*    19-Q   */           445,     26,     17,     21,      4,     22,      3,   1063,    644,    442,    272   },
        {  /*    19-H   */           341,     26,      9,     13,     16,     14,      3,    813,    493,    338,    208   },
        {  /*    20-L   */           861,     28,      3,    107,      5,    108,      3,   2061,   1249,    858,    528   },
        {  /*    20-M   */           669,     26,      3,     41,     13,     42,      3,   1600,    970,    666,    410   },
        {  /*    20-Q   */           485,     30,     15,     24,      5,     25,      3,   1159,    702,    482,    297   },
        {  /*    20-H   */           385,     28,     15,     15,     10,     16,      3,    919,    557,    382,    235   },
        {  /*    21-L   */           932,     28,      4,    116,      4,    117,      4,   2232,   1352,    929,    572   },
        {  /*    21-M   */           714,     26,     17,     42,      0,      0,      4,   1708,   1035,    711,    438   },
        {  /*    21-Q   */           512,     28,     17,     22,      6,     23,      4,   1224,    742,    509,    314   },
        {  /*    21-H   */           406,     30,     19,     16,      6,     17,      4,    969,    587,    403,    248   },
        {  /*    22-L   */          1006,     28,      2,    111,      7,    112,      4,   2409,   1460,   1003,    618   },
        {  /*    22-M   */           782,     28,     17,     46,      0,      0,      4,   1872,   1134,    779,    480   },
        {  /*    22-Q   */           568,     30,      7,     24,     16,     25,      4,   1358,    823,    565,    348   },
        {  /*    22-H   */           442,     24,     34,     13,      0,      0,      4,   1056,    640,    439,    270   },
        {  /*    23-L   */          1094,     30,      4,    121,      5,    122,      4,   2620,   1588,   1091,    672   },
        {  /*    23-M   */           860,     28,      4,     47,     14,     48,      4,   2059,   1248,    857,    528   },
        {  /*    23-Q   */           614,     30,     11,     24,     14,     25,      4,   1468,    890,    611,    376   },
        {  /*    23-H   */           464,     30,     16,     15,     14,     16,      4,   1108,    672,    461,    284   },
        {  /*    24-L   */          1174,     30,      6,    117,      4,    118,      4,   2812,   1704,   1171,    721   },
        {  /*    24-M   */           914,     28,      6,     45,     14,     46,      4,   2188,   1326,    911,    561   },
        {  /*    24-Q   */           664,     30,     11,     24,     16,     25,      4,   1588,    963,    661,    407   },
        {  /*    24-H   */           514,     30,     30,     16,      2,     17,      4,   1228,    744,    511,    315   },
        {  /*    25-L   */          1276,     26,      8,    106,      4,    107,      4,   3057,   1853,   1273,    784   },
        {  /*    25-M   */          1000,     28,      8,     47,     13,     48,      4,   2395,   1451,    997,    614   },
        {  /*    25-Q   */           718,     30,      7,     24,     22,     25,      4,   1718,   1041,    715,    440   },
        {  /*    25-H   */           538,     30,     22,     15,     13,     16,      4,   1286,    779,    535,    330   },
        {  /*    26-L   */          1370,     28,     10,    114,      2,    115,      4,   3283,   1990,   1367,    842   },
        {  /*    26-M   */          1062,     28,     19,     46,      4,     47,      4,   2544,   1542,   1059,    652   },
        {  /*    26-Q   */           754,     28,     28,     22,      6,     23,      4,   1804,   1094,    751,    462   },
        {  /*    26-H   */           596,     30,     33,     16,      4,     17,      4,   1425,    864,    593,    365   },
        {  /*    27-L   */          1468,     30,      8,    122,      4,    123,      4,   3517,   2132,   1465,    902   },
        {  /*    27-M   */          1128,     28,     22,     45,      3,     46,      4,   2701,   1637,   1125,    692   },
        {  /*    27-Q   */           808,     30,      8,     23,     26,     24,      4,   1933,   1172,    805,    496   },
        {  /*    27-H   */           628,     30,     12,     15,     28,     16,      4,   1501,    910,    625,    385   },
        {  /*    28-L   */          1531,     30,      3,    117,     10,    118,      3,   3669,   2223,   1528,    940   },
        {  /*    28-M   */          1193,     28,      3,     45,     23,     46,      3,   2857,   1732,   1190,    732   },
        {  /*    28-Q   */           871,     30,      4,     24,     31,     25,      3,   2085,   1263,    868,    534   },
        {  /*    28-H   */           661,     30,     11,     15,     31,     16,      3,   1581,    958,    658,    405   },
        {  /*    29-L   */          1631,     30,      7,    116,      7,    117,      3,   3909,   2369,   1628,   1002   },
        {  /*    29-M   */          1267,     28,     21,     45,      7,     46,      3,   3035,   1839,   1264,    778   },
        {  /*    29-Q   */           911,     30,      1,     23,     37,     24,      3,   2181,   1322,    908,    559   },
        {  /*    29-H   */           701,     30,     19,     15,     26,     16,      3,   1677,   1016,    698,    430   },
        {  /*    30-L   */          1735,     30,      5,    115,     10,    116,      3,   4158,   2520,   1732,   1066   },
        {  /*    30-M   */          1373,     28,     19,     47,     10,     48,      3,   3289,   1994,   1370,    843   },
        {  /*    30-Q   */           985,     30,     15,     24,     25,     25,      3,   2358,   1429,    982,    604   },
        {  /*    30-H   */           745,     30,     23,     15,     25,     16,      3,   1782,   1080,    742,    457   },
        {  /*    31-L   */          1843,     30,     13,    115,      3,    116,      3,   4417,   2677,   1840,   1132   },
        {  /*    31-M   */          1455,     28,      2,     46,     29,     47,      3,   3486,   2113,   1452,    894   },
        {  /*    31-Q   */          1033,     30,     42,     24,      1,     25,      3,   2473,   1499,   1030,    634   },
        {  /*    31-H   */           793,     30,     23,     15,     28,     16,      3,   1897,   1150,    790,    486   },
        {  /*    32-L   */          1955,     30,     17,    115,      0,      0,      3,   4686,   2840,   1952,   1201   },
        {  /*    32-M   */          1541,     28,     10,     46,     23,     47,      3,   3693,   2238,   1538,    947   },
        {  /*    32-Q   */          1115,     30,     10,     24,     35,     25,      3,   2670,   1618,   1112,    684   },
        {  /*    32-H   */           845,     30,     19,     15,     35,     16,      3,   2022,   1226,    842,    518   },
        {  /*    33-L   */          2071,     30,     17,    115,      1,    116,      3,   4965,   3009,   2068,   1273   },
        {  /*    33-M   */          1631,     28,     14,     46,     21,     47,      3,   3909,   2369,   1628,   1002   },
        {  /*    33-Q   */          1171,     30,     29,     24,     19,     25,      3,   2805,   1700,   1168,    719   },
        {  /*    33-H   */           901,     30,     11,     15,     46,     16,      3,   2157,   1307,    898,    553   },
        {  /*    34-L   */          2191,     30,     13,    115,      6,    116,      3,   5253,   3183,   2188,   1347   },
        {  /*    34-M   */          1725,     28,     14,     46,     23,     47,      3,   4134,   2506,   1722,   1060   },
        {  /*    34-Q   */          1231,     30,     44,     24,      7,     25,      3,   2949,   1787,   1228,    756   },
        {  /*    34-H   */           961,     30,     59,     16,      1,     17,      3,   2301,   1394,    958,    590   },
        {  /*    35-L   */          2306,     30,     12,    121,      7,    122,      0,   5529,   3351,   2303,   1417   },
        {  /*    35-M   */          1812,     28,     12,     47,     26,     48,      0,   4343,   2632,   1809,   1113   },
        {  /*    35-Q   */          1286,     30,     39,     24,     14,     25,      0,   3081,   1867,   1283,    790   },
        {  /*    35-H   */           986,     30,     22,     15,     41,     16,      0,   2361,   1431,    983,    605   },
        {  /*    36-L   */          2434,     30,      6,    121,     14,    122,      0,   5836,   3537,   2431,   1496   },
        {  /*    36-M   */          1914,     28,      6,     47,     34,     48,      0,   4588,   2780,   1911,   1176   },
        {  /*    36-Q   */          1354,     30,     46,     24,     10,     25,      0,   3244,   1966,   1351,    832   },
        {  /*    36-H   */          1054,     30,      2,     15,     64,     16,      0,   2524,   1530,   1051,    647   },
        {  /*    37-L   */          2566,     30,     17,    122,      4,    123,      0,   6153,   3729,   2563,   1577   },
        {  /*    37-M   */          1992,     28,     29,     46,     14,     47,      0,   4775,   2894,   1989,   1224   },
        {  /*    37-Q   */          1426,     30,     49,     24,     10,     25,      0,   3417,   2071,   1423,    876   },
        {  /*    37-H   */          1096,     30,     24,     15,     46,     16,      0,   2625,   1591,   1093,    673   },
        {  /*    38-L   */          2702,     30,      4,    122,     18,    123,      0,   6479,   3927,   2699,   1661   },
        {  /*    38-M   */          2102,     28,     13,     46,     32,     47,      0,   5039,   3054,   2099,   1292   },
        {  /*    38-Q   */          1502,     30,     48,     24,     14,     25,      0,   3599,   2181,   1499,    923   },
        {  /*    38-H   */          1142,     30,     42,     15,     32,     16,      0,   2735,   1658,   1139,    701   },
        {  /*    39-L   */          2812,     30,     20,    117,      4,    118,      0,   6743,   4087,   2809,   1729   },
        {  /*    39-M   */          2216,     28,     40,     47,      7,     48,      0,   5313,   3220,   2213,   1362   },
        {  /*    39-Q   */          1582,     30,     43,     24,     22,     25,      0,   3791,   2298,   1579,    972   },
        {  /*    39-H   */          1222,     30,     10,     15,     67,     16,      0,   2927,   1774,   1219,    750   },
        {  /*    40-L   */          2956,     30,     19,    118,      6,    119,      0,   7089,   4296,   2953,   1817   },
        {  /*    40-M   */          2334,     28,     18,     47,     31,     48,      0,   5596,   3391,   2331,   1435   },
        {  /*    40-Q   */          1666,     30,     34,     24,     34,     25,      0,   3993,   2420,   1663,   1024   },
        {  /*    40-H   */          1276,     30,     20,     15,     61,     16,      0,   3057,   1852,   1273,    784   }
    };

CONST UINT8 gAlphaNumerics[QR_ALPHA_TABLE_SIZE] = { // ISO 18004:2015 Table 5 Encoding for Alphanumeric mode
                        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B',
                        'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N',
                        'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',
                        ' ', '$', '%', '*', '+', '-', '.', '/', ':'};

CONST UINT8 gLengthBits[QR_LENGTH_ENTRIES][QR_ENCODER_ENTRIES] = {  // ISO 18004:2015 Table 3 Number of Bits in the length indicator
                            //  Lengths for Numeric, AlphaNumeric, Byte, and Kanjii
            {/* max QR Version */  9, 10,  9,  8,  8 },                    // Length bits for Versions 1-9
            {                     26, 12, 11, 16, 10 },                    // for Versions 10-26
            {                     40, 14, 13, 16, 12 }                     // for Versions 27-40
        };

CONST UINT16 gFormatInfo[QR_EC_LEVELS][QR_MASK_PATTERNS] = {  // Table C.1 ISO 18004:2015
                               // Reordered to align with L=1,M=2,Q=3,H=4 used in the code
                               /*    L 0 0111 0111 1100 0100 */ { 0x77C4,
                               /*    L 1 0111 0010 1111 0011 */   0x72F3,
                               /*    L 2 0111 1101 1010 1010 */   0x7DAA,
                               /*    L 3 0111 1000 1001 1101 */   0x789D,
                               /*    L 4 0110 0110 0010 1111 */   0x662F,
                               /*    L 5 0110 0011 0001 1000 */   0x6318,
                               /*    L 6 0110 1100 0100 0001 */   0x6C41,
                               /*    L 7 0110 1001 0111 0110 */   0x6976 } ,
                               /*    M 0 0101 0100 0001 0010 */ { 0x5412,
                               /*    M 1 0101 0001 0010 0101 */   0x5125,
                               /*    M 2 0101 1110 0111 1100 */   0x5E7C,
                               /*    M 3 0101 1011 0100 1011 */   0x5B4B,
                               /*    M 4 0100 0101 1111 1001 */   0x45F9,
                               /*    M 5 0100 0000 1100 1110 */   0x40CE,
                               /*    M 6 0100 1111 1001 0111 */   0x4F97,
                               /*    M 7 0100 1010 1010 0000 */   0x4AA0 } ,
                               /*    Q 0 0011 0101 0101 1111 */ { 0x355F,
                               /*    Q 1 0011 0000 0110 1000 */   0x3068,
                               /*    Q 2 0011 1111 0011 0001 */   0x3F31,
                               /*    Q 3 0011 1010 0000 0110 */   0x3A06,
                               /*    Q 4 0010 0100 1011 0100 */   0x24B4,
                               /*    Q 5 0010 0001 1000 0011 */   0x2183,
                               /*    Q 6 0010 1110 1101 1010 */   0x2EDA,
                               /*    Q 7 0010 1011 1110 1101 */   0x4BED } ,
                               /*    H 0 0001 0110 1000 1001 */ { 0x1689,
                               /*    H 1 0001 0011 1011 1110 */   0x13BE,
                               /*    H 2 0001 1100 1110 0111 */   0x1CE7,
                               /*    H 3 0001 1001 1101 0000 */   0x19D0,
                               /*    H 4 0000 0111 0110 0010 */   0x0762,
                               /*    H 5 0000 0010 0101 0101 */   0x0255,
                               /*    H 6 0000 1101 0000 1100 */   0x0D0C,
                               /*    H 7 0000 1000 0011 1011 */   0x083B } };

CONST UINT32 gVersionInfo[QR_CODES-6] = {  // Table D.1 ISO 18004:2015
                               /*   7 00 0111 1100 1001 0100 */  0x07C94,
                               /*   8 00 1000 0101 1011 1100 */  0x085BC,
                               /*   9 00 1001 1010 1001 1001 */  0x09A99,
                               /*  10 00 1010 0100 1101 0011 */  0x0A4D3,
                               /*  11 00 1011 1011 1111 0110 */  0x0BBF6,
                               /*  12 00 1100 0111 0110 0010 */  0x0C762,
                               /*  13 00 1101 1000 0100 0111 */  0x0D847,
                               /*  14 00 1110 0110 0000 1101 */  0x0E60D,
                               /*  15 00 1111 1001 0010 1000 */  0x0F928,
                               /*  16 01 0000 1011 0111 1000 */  0x10B78,
                               /*  17 01 0001 0100 0101 1101 */  0x1145D,
                               /*  18 01 0010 1010 0001 0111 */  0x12A17,
                               /*  19 01 0011 0101 0011 0010 */  0x13532,
                               /*  20 01 0100 1001 1010 0110 */  0x149A6,
                               /*  21 01 0101 0110 1000 0011 */  0x15683,
                               /*  22 01 0110 1000 1100 1001 */  0x168C9,
                               /*  23 01 0111 0111 1110 1100 */  0x177EC,
                               /*  24 01 1000 1110 1100 0100 */  0x18EC4,
                               /*  25 01 1001 0001 1110 0001 */  0x191E1,
                               /*  26 01 1010 1111 1010 1011 */  0x1AFAB,
                               /*  27 01 1011 0000 1000 1110 */  0x1B08E,
                               /*  28 01 1100 1100 0001 1010 */  0x1CC1A,
                               /*  29 01 1101 0011 0011 1111 */  0x1D33F,
                               /*  30 01 1110 1101 0111 0101 */  0x1ED75,
                               /*  31 01 1111 0010 0101 0000 */  0x1F250,
                               /*  32 10 0000 1001 1101 0101 */  0x209D5,
                               /*  33 10 0001 0110 1111 0000 */  0x216F0,
                               /*  34 10 0010 1000 1011 1010 */  0x228BA,
                               /*  35 10 0011 0111 1001 1111 */  0x2379F,
                               /*  36 10 0100 1011 0000 1011 */  0x24B0B,
                               /*  37 10 0101 0100 0010 1110 */  0x2542E,
                               /*  38 10 0110 1010 0110 0100 */  0x26A64,
                               /*  39 10 0111 0101 0100 0001 */  0x27541,
                               /*  40 10 1000 1100 0110 1001 */  0x28C69 };

CONST UINT8 gAlignmentLocations[QR_CODES - 1][QR_MAX_LOCATIONS] = {  // ISO 18004:2015 Table E.1 Location of alignment patterns
                  /*   2   */       { 6, 18,  0,  0,   0,   0,   0},
                  /*   3   */       { 6, 22,  0,  0,   0,   0,   0},
                  /*   4   */       { 6, 26,  0,  0,   0,   0,   0},
                  /*   5   */       { 6, 30,  0,  0,   0,   0,   0},
                  /*   6   */       { 6, 34,  0,  0,   0,   0,   0},
                  /*   7   */       { 6, 22, 38,  0,   0,   0,   0},
                  /*   8   */       { 6, 24, 42,  0,   0,   0,   0},
                  /*   9   */       { 6, 26, 46,  0,   0,   0,   0},
                  /*  10   */       { 6, 28, 50,  0,   0,   0,   0},
                  /*  11   */       { 6, 30, 54,  0,   0,   0,   0},
                  /*  12   */       { 6, 32, 58,  0,   0,   0,   0},
                  /*  13   */       { 6, 34, 62,  0,   0,   0,   0},
                  /*  14   */       { 6, 26, 46, 66,   0,   0,   0},
                  /*  15   */       { 6, 26, 48, 70,   0,   0,   0},
                  /*  16   */       { 6, 26, 50, 74,   0,   0,   0},
                  /*  17   */       { 6, 30, 54, 78,   0,   0,   0},
                  /*  18   */       { 6, 30, 56, 82,   0,   0,   0},
                  /*  19   */       { 6, 30, 58, 86,   0,   0,   0},
                  /*  20   */       { 6, 34, 62, 90,   0,   0,   0},
                  /*  21   */       { 6, 28, 50, 72,  94,   0,   0},
                  /*  22   */       { 6, 26, 50, 74,  98,   0,   0},
                  /*  23   */       { 6, 30, 54, 78, 102,   0,   0},
                  /*  24   */       { 6, 28, 54, 80, 106,   0,   0},
                  /*  25   */       { 6, 32, 58, 84, 110,   0,   0},
                  /*  26   */       { 6, 30, 58, 86, 114,   0,   0},
                  /*  27   */       { 6, 34, 62, 90, 118,   0,   0},
                  /*  28   */       { 6, 26, 50, 74,  98, 122,   0},
                  /*  29   */       { 6, 30, 54, 78, 102, 126,   0},
                  /*  30   */       { 6, 26, 52, 78, 104, 130,   0},
                  /*  31   */       { 6, 30, 56, 82, 108, 134,   0},
                  /*  32   */       { 6, 34, 60, 86, 112, 138,   0},
                  /*  33   */       { 6, 30, 58, 86, 114, 142,   0},
                  /*  34   */       { 6, 34, 62, 90, 118, 146,   0},
                  /*  35   */       { 6, 30, 54, 78, 102, 126, 150},
                  /*  36   */       { 6, 24, 50, 76, 102, 128, 154},
                  /*  37   */       { 6, 28, 54, 80, 106, 132, 158},
                  /*  38   */       { 6, 32, 58, 84, 110, 136, 162},
                  /*  39   */       { 6, 26, 54, 82, 110, 138, 166},
                  /*  40   */       { 6, 30, 58, 86, 114, 142, 170}
                                 };

 // Generator Polynomials  from ISO 18004:2015
CONST  UINT8 Code7[]  = { 0,  87, 229, 146, 149, 238, 102,  21 };
CONST  UINT8 Code10[] = { 0, 251,  67,  46,  61, 118,  70,  64,  94,  32,  45 };
CONST  UINT8 Code13[] = { 0,  74, 152, 176, 100,  86, 100, 106, 104, 130, 218, 206, 140,  78 };
CONST  UINT8 Code15[] = { 0,   8, 183,  61,  91, 202,  37,  51,  58,  58, 237, 140, 124,   5,  99, 105 };
CONST  UINT8 Code16[] = { 0, 120, 104, 107, 109, 102, 161,  76,   3,  91, 191, 147, 169, 182, 194, 225, 120 };
CONST  UINT8 Code17[] = { 0,  43, 139, 206,  78,  43, 239, 123, 206, 214, 147,  24,  99, 150,  39, 243, 163, 136 };
CONST  UINT8 Code18[] = { 0, 215, 234, 158,  94, 184,  97, 118, 170,  79, 187, 152, 148, 252, 179,   5,  98,  96, 153 };
CONST  UINT8 Code20[] = { 0,  17,  60,  79,  50,  61, 163,  26, 187, 202, 180, 221, 225,  83, 239, 156, 164, 212, 212, 188, 190 };
CONST  UINT8 Code22[] = { 0, 210, 171, 247, 242,  93, 230,  14, 109, 221,  53, 200,  74,   8, 172,  98,  80, 219, 134, 160, 105, 165, 231 };
CONST  UINT8 Code24[] = { 0, 229, 121, 135,  48, 211, 117, 251, 126, 159, 180, 169, 152, 192, 226, 228, 218, 111,   0, 117, 232,  87,  96, 227, 21 };
CONST  UINT8 Code26[] = { 0, 173, 125, 158,   2, 103, 182, 118,  17, 145, 201, 111,  28, 165,  53, 161,  21, 245, 142,  13, 102,  48, 227, 153, 145, 218, 70 };
CONST  UINT8 Code28[] = { 0, 168, 223, 200, 104, 224, 234, 108, 180, 110, 190, 195, 147, 205,  27, 232, 201,  21,  43, 245,  87,  42, 195, 212, 119, 242, 37,   9,  123 };
CONST  UINT8 Code30[] = { 0,  41, 173, 145, 152, 216,  31, 179, 182,  50,  48, 110,  86, 239,  96, 222, 125,  42, 173, 226, 193, 224, 130, 156,  37, 251, 216, 238,  40, 192, 180 };


CONST UINT8  *gGeneratorPolynomials[QR_MAX_GEN_POLYS] = {// ISO 18004:2015 Table A.1 - ISO has a sparse list up to 68.
                                           //However, only those code up to 30 are used
    /*  0 */ NULL,
    /*  1 */ NULL,
    /*  2 */ NULL,
    /*  3 */ NULL,
    /*  4 */ NULL,
    /*  5 */ NULL,
    /*  6 */ NULL,
    /*  7 */ Code7,
    /*  8 */ NULL,
    /*  9 */ NULL,
    /* 10 */ Code10,
    /* 11 */ NULL,
    /* 12 */ NULL,
    /* 13 */ Code13,
    /* 14 */ NULL,
    /* 15 */ Code15,
    /* 16 */ Code16,
    /* 17 */ Code17,
    /* 18 */ Code18,
    /* 19 */ NULL,
    /* 20 */ Code20,
    /* 21 */ NULL,
    /* 22 */ Code22,
    /* 23 */ NULL,
    /* 24 */ Code24,
    /* 25 */ NULL,
    /* 26 */ Code26,
    /* 27 */ NULL,
    /* 28 */ Code28,
    /* 29 */ NULL,
    /* 30 */ Code30,
    /* 31 */ NULL,
    /* 32 */ NULL,
    /* 33 */ NULL,
    /* 34 */ NULL,
    /* 35 */ NULL,
    /* 36 */ NULL,
    /* 37 */ NULL,
    /* 38 */ NULL,
    /* 39 */ NULL,
    /* 40 */ NULL,
    /* 41 */ NULL,
    /* 42 */ NULL,
    /* 43 */ NULL,
    /* 44 */ NULL,
    /* 45 */ NULL,
    /* 46 */ NULL,
    /* 47 */ NULL,
    /* 48 */ NULL,
    /* 49 */ NULL,
    /* 50 */ NULL,
    /* 51 */ NULL,
    /* 52 */ NULL,
    /* 53 */ NULL,
    /* 54 */ NULL,
    /* 55 */ NULL,
    /* 56 */ NULL,
    /* 57 */ NULL,
    /* 58 */ NULL,
    /* 59 */ NULL,
    /* 60 */ NULL,
    /* 61 */ NULL,
    /* 62 */ NULL,
    /* 63 */ NULL,
    /* 64 */ NULL,
    /* 65 */ NULL,
    /* 66 */ NULL,
    /* 67 */ NULL,
    /* 68 */ NULL
} ;


UINT8 logTable[GF256_SIZE];
UINT8 alogTable[GF256_SIZE];

// Debug Flags
#define debugLogTables FALSE

//************************************************************************************************************/
// The polynomial arithmetic for QR Code shall be calculated using bit-wise modulo 2 arithmetic and bytewise */
// modulo 100011101 arithmetic. This is a Galois field of 2^8 with 100011101 representing the field's        */
// prime modulus polynomial x^8 + x^4 + x^3 + x^2 + 1.                                                       */
//************************************************************************************************************/
CONST INTN QR_modulo = 285;  // From ISO 18004:2015 spec (285 = b'100011101'
VOID InitializeLogTables()
{
    UINTN b;
    UINT16 i;

    b = 1;
    for (i = 0; i < sizeof(logTable); i++) {
        alogTable[i] = (UINT8) b;
        logTable[b] = (UINT8) i;
        b <<= 1;
        if (b & 256) {
            b = b ^ QR_modulo;
        }
    }
    logTable[0] = 0;
    logTable[1] = 0;

    if (debugLogTables)
    {
        for (i = 0; i < sizeof(logTable); i++)
        {
            DEBUG((DEBUG_INFO," i=%3d log=%3d alog=%3d\n", i, logTable[i], alogTable[i]));
        }
    }
}
